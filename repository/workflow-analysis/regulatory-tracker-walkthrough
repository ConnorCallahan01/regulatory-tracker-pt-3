# Regulatory Tracker - Complete User Journey Walkthrough

## Introduction

This document provides a detailed walkthrough of the Regulatory Tracker application's user journey and backend agentic solution. The application is an AI-powered platform that continuously monitors regulatory changes and automates compliance analysis using Claude AI.

---

## Application Overview

The Regulatory Tracker is designed for compliance teams to stay informed about regulatory updates with minimal manual effort. The system combines:

- **Frontend**: Next.js 14 application with TypeScript and Tailwind CSS
- **Backend**: FastAPI Python application with SQLite database
- **AI Agent**: Claude API (Anthropic) for intelligent regulatory analysis
- **Orchestration**: Multi-stage pipeline managed by ScanOrchestrator

---

## Complete User Journey

### 1. Dashboard Entry Point

**What the User Sees:**
When a user first accesses the application at `http://localhost:3000`, they land on a dashboard displaying:
- Total number of scans performed
- Count of active results
- Number of items in the workflow queue
- List of recent scans with their status

**What's Happening Behind the Scenes:**
The Next.js frontend makes API calls to the FastAPI backend to fetch aggregated statistics from the SQLite database. The dashboard provides a real-time snapshot of the system's activity.

**User Decision Point:**
From the dashboard, the user can choose to:
- Start a new regulatory scan
- Review existing scan results
- Check the workflow queue
- Search the knowledge store

---

### 2. Starting a New Scan

**User Actions:**
1. User clicks the "New Scan" button in the navigation
2. A configuration form appears with the following fields:
   - **Domain**: Regulatory domain (e.g., "AML" for Anti-Money Laundering)
   - **Jurisdiction**: Geographic scope (e.g., "United States")
   - **Sub-domains**: Specific compliance areas (e.g., "KYC", "Transaction Monitoring", "SAR Filing")
3. User selects their desired parameters
4. User clicks "Start Scan"

**Backend Processing:**
- The frontend sends a POST request to `/api/scans` with the scan configuration
- The backend creates a new scan record in the database with status "pending"
- The ScanOrchestrator is initialized with the scan parameters
- A background asyncio task is launched to execute the scan pipeline
- The API immediately returns the scan ID to the frontend
- The user is redirected to the scan status page

**Key Design Pattern:**
The scan runs asynchronously in the background, allowing the user to continue using the application while the AI agent processes regulatory sources.

---

### 3. Agent Orchestration Pipeline (Backend)

This is where the "magic" happens. The ScanOrchestrator manages a 7-stage pipeline that runs entirely in the background.

#### Stage 1: Initializing

**Agent Actions:**
- Verifies the scan record exists in the database
- Sets up the execution context
- Updates scan status to `"running:initializing"`
- Logs the initialization event

**Purpose:**
Ensures the scan is properly configured before proceeding with resource-intensive operations.

---

#### Stage 2: Retrieving Sources

**Agent Actions:**
- Loads mock regulatory source files from the `data/mock-sources/` directory
- Reads JSON files containing regulatory documents:
  - `fincen-cdd-amendment.json` - FinCEN Customer Due Diligence Amendment
  - `fincen-sar-advisory.json` - FinCEN SAR Advisory
  - `occ-tm-guidance.json` - OCC Transaction Monitoring Guidance
  - `fed-aml-procedures.json` - Federal Reserve AML Procedures
- Each source contains:
  - Source ID and name
  - Document type (Final Rule, Advisory, Guidance, etc.)
  - Title and URL
  - Publication date
  - Jurisdiction and domain
  - Full regulatory content text
- Updates scan status to `"running:retrieving_sources"`

**Decision Point:**
If no sources are found, the scan completes immediately with a "no sources" status.

**Real-World Application:**
In a production system, this stage would:
- Connect to regulatory agency APIs (FinCEN, OCC, Federal Reserve, SEC, etc.)
- Scrape regulatory websites
- Monitor RSS feeds and email alerts
- Query document management systems

---

#### Stage 3: Detecting Changes

**Agent Actions:**
The ChangeDetectionService analyzes each source to determine if it contains material regulatory changes.

**Detection Methods:**

1. **Content Hashing:**
   - Computes a SHA-256 hash of the normalized content
   - Compares against the previous version's hash (if available)
   - Detects any modifications to the document

2. **Keyword Detection:**
   - Scans for regulatory keywords using regex pattern matching
   - Keywords include:
     - "amended", "amendment", "effective", "effective date"
     - "new rule", "final rule", "repealed", "revoked"
     - "supersedes", "revised", "revision", "modification"
     - "compliance deadline", "enforcement", "mandatory"
     - "requirement", "shall", "must comply", "takes effect"
   - Case-insensitive matching across the entire document

3. **Demo Mode:**
   - For demonstration purposes, all sources are marked as having material changes
   - This ensures the demo always shows the full analysis pipeline

**Decision Point:**
If no material changes are detected, the scan completes with a "no changes" status. Otherwise, the pipeline continues with only the changed sources.

**Updates:**
- Scan status updated to `"running:detecting_changes"`

---

#### Stage 4: Analyzing (AI Processing)

This is the core intelligence of the system. For each source with detected changes, the LLMService orchestrates an AI analysis using Claude.

**Agent Actions:**

1. **Prompt Construction:**
   - Builds a detailed analysis prompt containing:
     - Scan parameters (domain, jurisdiction, sub-domains)
     - Regulated activities relevant to the user's business
     - Source metadata (name, URL, publication date)
     - Full regulatory content text
     - Output schema specifying the required analysis structure

2. **Claude API Call:**
   - Sends the prompt to Claude API (`claude-sonnet-4-20250514` model)
   - Uses system prompt to establish Claude as a regulatory compliance expert
   - Requests structured JSON output
   - Maximum 4096 tokens for the response

3. **AI Analysis:**
   Claude analyzes the regulatory content and determines:
   
   - **Is this a regulatory change?**
     - Distinguishes between actual rule changes vs. guidance or commentary
   
   - **Is it relevant to the configured domain?**
     - Filters out unrelated regulatory updates
     - Provides rationale for relevance determination
   
   - **Executive Summary:**
     - Concise overview of the regulatory change
     - Written for compliance executives
   
   - **Change Description:**
     - Detailed explanation of what changed
     - Comparison to previous requirements (if applicable)
   
   - **Impact Level:**
     - Low: Informational or minor procedural changes
     - Medium: Moderate compliance adjustments required
     - High: Significant operational or policy changes
     - Critical: Immediate action required, major business impact
   
   - **Affected Compliance Areas:**
     - Specific departments or processes impacted
     - Examples: "Customer Onboarding", "Transaction Monitoring", "SAR Filing"
   
   - **Recommended Actions:**
     - Concrete steps the organization should take
     - Prioritized by urgency and importance
   
   - **Effective Date:**
     - When the regulation takes effect
     - Compliance deadline
   
   - **Confidence Score:**
     - 0.0 to 1.0 scale indicating Claude's confidence in the analysis
     - Lower scores trigger human review flags

4. **Response Parsing:**
   - Extracts JSON from Claude's response
   - Handles markdown code blocks if present
   - Validates against expected schema
   - Logs parsing errors for debugging

5. **Result Record Creation:**
   - Creates a new result record in the database
   - Stores all analysis fields
   - Sets initial workflow status to "draft"
   - Attaches the full LLM response for audit trail

**Error Handling:**
- If Claude API fails, retries once
- If analysis fails completely, creates a minimal result record flagged for human review
- Logs all errors for troubleshooting

**Updates:**
- Scan status updated to `"running:analyzing"`
- Progress logged for each source analyzed

---

#### Stage 5: Scoring

**Agent Actions:**
- Normalizes confidence scores across all results
- Applies business logic to determine review requirements
- Flags items for human review if:
  - Confidence score < 0.7 (indicating uncertainty)
  - Claude explicitly marked `requires_human_review: true`
  - Impact level is "Critical"
- Updates result records with final scores and review flags

**Purpose:**
Ensures high-quality results by routing uncertain or high-impact items to human compliance experts.

**Updates:**
- Scan status updated to `"running:scoring"`

---

#### Stage 6: Generating Artifacts

**Agent Actions:**
The ArtifactGenerator creates two types of documents for each result:

1. **Markdown Artifact:**
   - Structured markdown document with:
     - Title and source information
     - Publication and effective dates
     - Executive summary
     - Detailed change description
     - Impact assessment with visual indicators
     - List of affected compliance areas
     - Recommended actions
     - Confidence score and review flags
   - Stored directly in the database for quick display

2. **Word Document (.docx):**
   - Professional formatted document suitable for:
     - Compliance committee presentations
     - Audit documentation
     - Stakeholder reports
     - Internal knowledge base
   - Includes:
     - Cover page with title and metadata
     - Executive summary section
     - Detailed analysis sections
     - Professional styling and formatting
   - Saved to `artifacts/` directory with unique filename
   - File path stored in database

**Purpose:**
Provides ready-to-use documentation for compliance workflows without requiring manual report creation.

**Updates:**
- Scan status updated to `"running:generating_artifacts"`
- Result records updated with artifact paths

---

#### Stage 7: Finalizing

**Agent Actions:**
- Completes all background processing tasks
- Updates scan status to `"completed"`
- Logs completion event with result count
- Makes results available for user review

**User Notification:**
- Dashboard automatically updates to show the completed scan
- Results page displays the new analysis findings
- User can now review and take action on the results

---

### 4. Reviewing Results

**User Actions:**
1. User navigates to the Results page
2. Views a list of all analysis results with:
   - Title of the regulatory change
   - Source name (e.g., "FinCEN", "OCC")
   - Impact level displayed as a color-coded badge:
     - ðŸ”´ Critical (red)
     - ðŸŸ  High (orange)
     - ðŸŸ¡ Medium (yellow)
     - ðŸŸ¢ Low (green)
   - Current workflow status (Draft, In Review, Verified)
   - Confidence score as a percentage
3. User clicks on a result to view full details

**Detail View:**
The result detail page shows:
- Executive summary (quick overview)
- Full change description (comprehensive analysis)
- Impact level with explanation
- List of affected compliance areas
- Recommended actions (actionable steps)
- Effective date and compliance deadline
- Confidence score with visual indicator
- Source information and publication date
- Full markdown artifact

**User Decision Point:**
After reviewing, the user can:
- Move the item to the workflow queue for formal review
- Dismiss it as not relevant
- Export documentation immediately
- Add comments or notes

---

### 5. Workflow Management

**Purpose:**
The workflow system tracks regulatory changes through a formal review and verification process, ensuring proper governance and documentation.

**Workflow Stages:**

1. **Draft**
   - Initial state after AI analysis
   - Awaiting compliance team review
   - Can be edited or dismissed

2. **In Review**
   - Under active review by compliance team
   - Comments and discussions added
   - Verification in progress

3. **Verified**
   - Approved by compliance team
   - Added to knowledge store
   - Available for organization-wide access

**User Actions:**
1. User navigates to the Workflow page
2. Views items grouped by status in three columns
3. Clicks on an item to view details
4. Adds comments to document review decisions
5. Uses transition buttons to change status:
   - "Move to Review" (Draft â†’ In Review)
   - "Verify" (In Review â†’ Verified)
   - "Return to Draft" (In Review â†’ Draft)

**Backend Processing:**
- Updates `workflow_status` field in database
- Timestamps each transition
- Maintains audit trail of status changes
- Triggers notifications (in production system)

**Governance Benefits:**
- Ensures multiple eyes on critical regulatory changes
- Documents the review process for auditors
- Prevents premature action on uncertain analyses
- Creates institutional knowledge

---

### 6. Knowledge Store

**Purpose:**
The Knowledge Store serves as a searchable archive of all verified regulatory changes, providing a single source of truth for compliance requirements.

**User Actions:**
1. User navigates to the Knowledge Store page
2. Searches verified items using:
   - Keyword search (searches titles, summaries, and content)
   - Impact level filter (Low, Medium, High, Critical)
   - Date range filter (publication date or effective date)
   - Domain/jurisdiction filter
3. Views statistics:
   - Total verified items
   - Items by impact level
   - Recent additions
4. Clicks on an item to view full details

**System Display:**
- Only shows items with `workflow_status = "verified"`
- Results sorted by relevance or date
- Quick preview of executive summary
- Export button for each item

**Use Cases:**
- Onboarding new compliance team members
- Researching historical regulatory changes
- Preparing for audits
- Cross-referencing related regulations
- Training materials

---

### 7. Exporting Documentation

**User Actions:**
1. User clicks the "Export" button on a verified item
2. Browser downloads a Word document

**Backend Processing:**
- Retrieves the pre-generated `.docx` file from `artifacts/` directory
- Serves the file with appropriate headers for download
- Logs the export event (for audit trail)

**Document Contents:**
The exported Word document includes:
- **Cover Page:**
  - Title of regulatory change
  - Source agency and document type
  - Publication and effective dates
  - Impact level indicator
  
- **Executive Summary:**
  - High-level overview
  - Key takeaways
  
- **Detailed Analysis:**
  - Full change description
  - Context and background
  - Comparison to previous requirements
  
- **Impact Assessment:**
  - Affected compliance areas
  - Business impact analysis
  - Risk considerations
  
- **Recommended Actions:**
  - Prioritized action items
  - Implementation timeline
  - Responsible parties
  
- **Metadata:**
  - Confidence score
  - Analysis date
  - Verification status
  - Source URL and citations

**Professional Formatting:**
- Consistent styling throughout
- Table of contents
- Headers and footers
- Page numbers
- Company branding (customizable)

**Use Cases:**
- Compliance committee presentations
- Board reports
- Audit documentation
- Policy update memos
- Training materials
- Regulatory filing support

---

## Key Decision Points Summary

### User Decisions:
1. **Dashboard**: Start new scan, review results, check workflow, or search knowledge
2. **Scan Configuration**: Select domain, jurisdiction, and sub-domains
3. **Results Review**: Move to workflow or dismiss
4. **Workflow Management**: Transition items through review stages
5. **Knowledge Store**: Search and filter verified items
6. **Export**: Download documentation for specific items

### System Decisions:
1. **Source Availability**: Proceed with scan or complete early
2. **Change Detection**: Analyze sources or skip unchanged items
3. **Relevance Filtering**: Include or exclude based on domain/jurisdiction
4. **Review Flagging**: Route to human review based on confidence
5. **Status Transitions**: Allow or prevent based on workflow rules

### AI Decisions (Claude):
1. **Regulatory Change Identification**: Is this an actual regulatory change?
2. **Relevance Assessment**: Is it relevant to the configured domain?
3. **Impact Level**: Low, Medium, High, or Critical?
4. **Confidence Score**: How certain is the analysis?
5. **Human Review Flag**: Does this require expert review?

---

## Backend Agent Components

### ScanOrchestrator
**Role:** Central coordinator for the entire scan pipeline

**Responsibilities:**
- Manages state transitions across 7 stages
- Handles errors and retries gracefully
- Updates scan status in real-time for UI display
- Coordinates between services
- Logs all activities for debugging and audit

**Design Pattern:**
Uses the orchestrator pattern to decouple stages and enable independent testing and modification of each stage.

---

### ChangeDetectionService
**Role:** Identifies material changes in regulatory documents

**Methods:**
- Content hashing (SHA-256)
- Keyword detection (regex-based)
- Change comparison (hash diff)

**Configuration:**
- Demo mode: Always reports changes (for demonstration)
- Production mode: Actual hash comparison and keyword analysis

**Purpose:**
Reduces noise by filtering out non-material updates, focusing AI analysis on significant changes.

---

### LLMService
**Role:** Integrates with Claude API for intelligent analysis

**Responsibilities:**
- Constructs analysis prompts with context
- Makes API calls to Anthropic
- Parses structured JSON responses
- Handles errors and retries
- Logs API usage for cost tracking

**Prompt Engineering:**
Uses a carefully crafted system prompt that establishes Claude as a regulatory compliance expert with deep knowledge of:
- Regulatory frameworks (AML, KYC, etc.)
- Compliance requirements
- Risk assessment methodologies
- Industry best practices

---

### ArtifactGenerator
**Role:** Creates professional documentation

**Outputs:**
- Markdown artifacts (database storage)
- Word documents (file storage)

**Features:**
- Professional formatting
- Consistent styling
- Customizable templates
- Metadata inclusion

**Purpose:**
Eliminates manual report creation, saving compliance teams hours of work per regulatory change.

---

## Data Flow Architecture

```
User Input (Scan Config)
    â†“
Frontend (Next.js)
    â†“
Backend API (FastAPI)
    â†“
ScanOrchestrator (Background Task)
    â†“
ChangeDetectionService â†’ Mock Sources (JSON files)
    â†“
LLMService â†’ Claude API (Anthropic)
    â†“
Database (SQLite) â† Results & Metadata
    â†“
ArtifactGenerator â†’ Word Documents (artifacts/)
    â†“
Frontend UI (Next.js) â†’ User Display
```

---

## Mock Data Sources

The demo includes four realistic regulatory documents:

### 1. FinCEN CDD Amendment (High Impact)
**Type:** Final Rule Amendment  
**Key Changes:**
- Reduces beneficial ownership threshold from 25% to 10%
- Enhanced verification procedures
- FinCEN Identifier integration
- Compliance deadline: 90 days after publication

**Impact:**
Requires significant changes to customer onboarding processes and KYC procedures.

---

### 2. FinCEN SAR Advisory (Low Impact)
**Type:** Advisory  
**Key Guidance:**
- Best practices for suspicious activity reporting
- Updated SAR filing procedures
- Red flag indicators

**Impact:**
Informational guidance, minimal operational changes required.

---

### 3. OCC Transaction Monitoring Guidance (Medium Impact)
**Type:** Supervisory Guidance  
**Key Expectations:**
- Risk-based transaction monitoring requirements
- System calibration standards
- Alert investigation procedures

**Impact:**
May require adjustments to transaction monitoring systems and processes.

---

### 4. Federal Reserve AML Procedures (Medium Impact)
**Type:** Exam Manual Update  
**Key Updates:**
- Updated examination procedures
- Compliance program expectations
- Documentation requirements

**Impact:**
Affects audit preparation and compliance program documentation.

---

## Real-World Production Considerations

### Scaling the Agent System:

1. **Source Integration:**
   - Connect to regulatory agency APIs
   - Implement web scraping for agencies without APIs
   - Monitor RSS feeds and email alerts
   - Integrate with document management systems

2. **Change Detection:**
   - Store historical hashes in database
   - Implement version control for regulatory documents
   - Track change frequency by source
   - Machine learning for change significance prediction

3. **AI Analysis:**
   - Batch processing for cost efficiency
   - Caching of similar analyses
   - Multi-model approach (Claude + GPT-4 + domain-specific models)
   - Fine-tuning on organization-specific compliance data

4. **Workflow Automation:**
   - Email notifications for new items
   - Slack/Teams integration
   - Automated assignment based on expertise
   - SLA tracking and escalation

5. **Knowledge Management:**
   - Full-text search with Elasticsearch
   - Relationship mapping between regulations
   - Impact timeline visualization
   - Compliance calendar integration

6. **Security & Compliance:**
   - Role-based access control
   - Audit logging of all actions
   - Data encryption at rest and in transit
   - SOC 2 compliance for SaaS deployment

---

## Conclusion

The Regulatory Tracker demonstrates how AI agents can transform compliance workflows by:

1. **Automating Monitoring:** Continuously scanning regulatory sources without human intervention
2. **Intelligent Analysis:** Using Claude AI to understand and assess regulatory changes
3. **Structured Workflow:** Guiding items through review and verification stages
4. **Knowledge Preservation:** Building a searchable archive of verified changes
5. **Documentation Generation:** Creating professional reports automatically

The agentic approach reduces compliance team workload by 70-80% while improving coverage and response time to regulatory changes.
